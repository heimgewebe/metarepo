From 1234567890abcdef1234567890abcdef12345678 Mon Sep 17 00:00:00 2001
From: Alexander Mohr <alex@example.com>
Date: Sat, 15 Nov 2025 08:15:00 +0000
Subject: [PATCH] chore(wgx): Metarepo auf WGX v1 (meta-class) umstellen

- Fügt ein WGX-Profil für das Metarepo mit class: meta hinzu.
- Vereinfacht die zentralen wgx-Guard/Smoke-Workflows:
  CI ruft nur noch ./wgx/wgx guard|smoke auf.
- Entfernt das alte Schema-/Profile-Parsen aus den Workflows;
  Profilformat ist ab jetzt allein WGX-Sache.

---
 .wgx/profile.yml                 | 57 ++++++++++++++++++++++++++++++++++++++++
 .github/workflows/wgx-guard.yml  | 52 ++++++++++++++++++++++++++++++++----
 .github/workflows/wgx-smoke.yml  | 33 ++++++++++++++++++++++
 3 files changed, 136 insertions(+), 6 deletions(-)
 create mode 100644 .wgx/profile.yml
 create mode 100644 .github/workflows/wgx-smoke.yml

diff --git a/.wgx/profile.yml b/.wgx/profile.yml
new file mode 100644
index 0000000..1111111
--- /dev/null
+++ b/.wgx/profile.yml
@@ -0,0 +1,57 @@
+class: meta
+
+tasks:
+  smoke: |
+    echo "Running workflow validation..."
+    python3 - <<'EOF'
+import glob, yaml, sys, pathlib
+
+files = list(glob.glob('.github/workflows/*.yml'))
+if not files:
+    print("No workflows found, skipping.")
+    sys.exit(0)
+
+for f in files:
+    try:
+        data = yaml.safe_load(pathlib.Path(f).read_text(encoding="utf-8"))
+        if not isinstance(data, dict):
+            raise TypeError("workflow root must be a mapping")
+        print(f"OK   {f}")
+    except Exception as e:
+        print(f"FAIL {f}: {e}")
+        sys.exit(1)
+
+print("All workflows valid.")
+EOF
+
+  guard: |
+    echo "Running meta-guard checks..."
+
+    if command -v shellcheck >/dev/null 2>&1; then
+      echo "Running shellcheck on wgx/**/*.bash..."
+      # bewusst fokussiert auf WGX-Bash-Module; bei Bedarf erweiterbar
+      shellcheck -s bash wgx/**/*.bash || exit 1
+    else
+      echo "shellcheck not found; skipping shell lint."
+    fi
+
+    if command -v yamllint >/dev/null 2>&1; then
+      echo "Running yamllint..."
+      yamllint . || exit 1
+    else
+      echo "yamllint not found; skipping YAML lint."
+    fi
+
+    echo "Guard OK."
+
+  metrics: |
+    if [ -x scripts/wgx-metrics-snapshot.sh ]; then
+      scripts/wgx-metrics-snapshot.sh --json
+    else
+      echo "No metrics script for metarepo, skipping."
+    fi
+
+  snapshot: ""
diff --git a/.github/workflows/wgx-guard.yml b/.github/workflows/wgx-guard.yml
index acf0681..2222222 100644
--- a/.github/workflows/wgx-guard.yml
+++ b/.github/workflows/wgx-guard.yml
@@ -1,83 +1,52 @@
-name: wgx-guard
-permissions:
-  contents: read
-
-on:
-  push:
-    paths:
-      - ".wgx/**"
-      - ".github/workflows/wgx-guard.yml"
-      - "pyproject.toml"
-      - "Cargo.toml"
-  pull_request:
-    paths:
-      - ".wgx/**"
-      - ".github/workflows/wgx-guard.yml"
-      - "pyproject.toml"
-      - "Cargo.toml"
-  workflow_dispatch:
-
-jobs:
-  guard:
-    runs-on: ubuntu-latest
-    timeout-minutes: 5
-    steps:
-      - uses: actions/checkout@v4
-
-      - name: Check .wgx/profile.yml presence
-        run: |
-          test -f .wgx/profile.yml || { echo "::error::.wgx/profile.yml missing"; exit 1; }
-          echo "found .wgx/profile.yml"
-
-      - name: Validate minimal schema keys
-        uses: actions/setup-python@v5
-        with:
-          python-version: '3.12'
-      - name: Install PyYAML
-        run: python -m pip install --upgrade pip pyyaml
-      - name: Run schema-lite check
-        run: |
-          python - <<'PY'
-import sys, yaml, pathlib
-p = pathlib.Path(".wgx/profile.yml")
-data = yaml.safe_load(p.read_text(encoding="utf-8"))
-required_top = ["version","env_priority","tooling","tasks"]
-missing = [k for k in required_top if k not in data]
-if missing:
-    print(f"::error::missing keys: {missing}")
-    sys.exit(1)
-envp = data["env_priority"]
-if not isinstance(envp, list) or not envp:
-    print("::error::env_priority must be a non-empty list")
-    sys.exit(1)
-for t in ["up","lint","test","build","smoke"]:
-    if t not in data["tasks"]:
-        print(f"::error::task '{t}' missing")
-        sys.exit(1)
-print("schema-lite ok")
-PY
-
-      - name: Cache uv downloads
-        if: ${{ hashFiles('pyproject.toml', 'uv.lock') != '' }}
-        uses: actions/cache@v4
-        with:
-          path: ~/.cache/uv
-          key: uv-${{ runner.os }}-${{ hashFiles('pyproject.toml', 'uv.lock') }}
-          restore-keys: |
-            uv-${{ runner.os }}-
-
-      - name: (Optional) UV bootstrap (pyproject present)
-        if: ${{ hashFiles('pyproject.toml') != '' }}
-        run: |
-          curl -LsSf https://astral.sh/uv/install.sh | sh
-          echo "$HOME/.local/bin" >> $GITHUB_PATH
-          export PATH="$HOME/.local/bin:$PATH"
-          uv --version
-          uv sync --frozen
-
-      - name: Done
-        run: echo "wgx-guard passed ✅"
+name: wgx-guard
+
+permissions:
+  contents: read
+
+on:
+  push:
+    paths:
+      - ".wgx/**"
+      - ".github/workflows/wgx-guard.yml"
+  pull_request:
+    paths:
+      - ".wgx/**"
+      - ".github/workflows/wgx-guard.yml"
+  workflow_dispatch:
+
+jobs:
+  guard:
+    runs-on: ubuntu-latest
+    timeout-minutes: 5
+    steps:
+      - name: Checkout repository
+        uses: actions/checkout@v4
+
+      - name: Ensure wgx entrypoint exists
+        run: |
+          set -euo pipefail
+          if [[ ! -x ./wgx/wgx ]]; then
+            echo "::error::./wgx/wgx not found or not executable"
+            exit 1
+          fi
+          echo "Found ./wgx/wgx"
+
+      - name: Run wgx guard
+        run: |
+          set -euo pipefail
+          ./wgx/wgx guard
diff --git a/.github/workflows/wgx-smoke.yml b/.github/workflows/wgx-smoke.yml
new file mode 100644
index 0000000..3333333
--- /dev/null
+++ b/.github/workflows/wgx-smoke.yml
@@ -0,0 +1,33 @@
+name: wgx-smoke
+
+permissions:
+  contents: read
+
+on:
+  push:
+    paths:
+      - ".wgx/**"
+      - ".github/workflows/wgx-smoke.yml"
+  pull_request:
+    paths:
+      - ".wgx/**"
+      - ".github/workflows/wgx-smoke.yml"
+  workflow_dispatch:
+
+jobs:
+  smoke:
+    runs-on: ubuntu-latest
+    timeout-minutes: 5
+    steps:
+      - name: Checkout repository
+        uses: actions/checkout@v4
+
+      - name: Ensure wgx entrypoint exists
+        run: |
+          set -euo pipefail
+          if [[ ! -x ./wgx/wgx ]]; then
+            echo "::error::./wgx/wgx not found or not executable"
+            exit 1
+          fi
+          echo "Found ./wgx/wgx"
+
+      - name: Run wgx smoke
+        run: |
+          set -euo pipefail
+          ./wgx/wgx smoke
--
2.46.0
