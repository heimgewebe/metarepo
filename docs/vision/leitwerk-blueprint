# leitwerk

## Koordinationsorgan für agentische Multirepo-Arbeit im Heimgewebe

*(ACS Control-Surface · agentenneutral · durchsetzungsstark · auditierbar)*

---

## Dialektische Grundlegung

Ein autopoetisches Heimgewebe entsteht nicht durch möglichst autonome Agenten,  
sondern durch **harte, geschlossene Regelkreise zwischen Vorschlag und Wirklichkeit**:

**Intent → Vorschlag → Entscheidung → Ausführung → Prüfung → Artefakt → Beobachtung**

ACS ist die Control-Surface.  
Agenten liefern Vorschläge.  
**leitwerk entscheidet, was Realität werden darf.**

WGX, Contracts, Chronik und Leitstand bilden die Membran,  
ohne die Geschwindigkeit zwangsläufig in Drift umschlägt.

Autopoiesis bedeutet hier:
> Der Organismus verändert sich, ohne seine Invarianten zu verlieren.

---

## Klärung (entscheidend)

**leitwerk ist kein Agent.**  
**leitwerk ist kein Erkenntnisorgan.**  
**leitwerk generiert keinen Code aus sich heraus.**

leitwerk ist das **Koordinations-, Durchsetzungs- und Audit-Organ**  
zwischen externen Agenten und dem Heimgewebe-Organismus.

Agenten:
- analysieren
- planen
- schlagen vor

leitwerk:
- rahmt
- sequenziert
- erzwingt
- protokolliert

Heimgeist reflektiert.  
Heimlern lernt.  
WGX entscheidet.  
Chronik erinnert.  
Leitstand macht sichtbar.

---

## Zielbild

leitwerk ist ein in **ACS eingebettetes (Sidecar-basiertes)** Koordinationsorgan, das:

- menschliche Prompts **und** systemische Trigger entgegennimmt,
- externe Agenten (z. B. Jules CLI, Copilot SDK) gezielt aufruft,
- deren Ergebnisse normalisiert und bewertet,
- Multi-Repo-Vorhaben zerlegt und sequenziert,
- Git-Operationen **ausschließlich kontrolliert** ausführt,
- branch-only Änderungen erzwingt,
- WGX-Guards kompromisslos durchsetzt,
- PR-Ketten koordiniert,
- und jede Entscheidung als **Artefakt + Event** persistiert.

leitwerk ist damit **kein Autopilot**, sondern ein **Verantwortungsfilter**.

---

## Unverhandelbare Invarianten

- Agent ≠ Git
- Kein Auto-Apply
- Kein Auto-Commit
- Kein Auto-PR
- Branch-only (niemals `main` / `master`)
- WGX schlägt Agent
- Unsicherheit ist ein Artefakt
- Chronik ist Gedächtnis, nicht Logging

Wenn eine dieser Regeln fällt, verliert leitwerk seine Funktion.

---

## Rolle im Organismus

### leitwerk

**Aufgaben**
- Koordination
- Sequenzierung
- Durchsetzung
- Audit
- Konsistenzwahrung über Repos hinweg

**Tut ausdrücklich nicht**
- denken
- halluzinieren
- bewerten
- optimieren
- „helfen wollen“

---

### Agenten (extern, austauschbar)

Beispiele:
- Jules CLI
- Copilot SDK
- spätere spezialisierte Agenten

**Aufgaben**
- Analyse
- Planungsvorschläge
- Patch-Vorschläge
- Begründungen

**Status**
- fehlbar
- nicht autoritativ
- jederzeit austauschbar

---

### Heimgeist

Heimgeist bleibt zuständig für:
- Reflexion
- Verdichtung
- Einsichten
- Meta-Bewertung

Heimgeist **koordiniert keine Agenten**  
Heimgeist **führt nichts aus**

---

## Architektur (Idealform)

Client (Desktop / iPad)  
→ ACS (Control Surface)  
→ leitwerk (Sidecar, localhost)  
→ Agenten (Jules, Copilot, …)  
→ Vorschläge (Plan / Patch / Text)  
→ leitwerk  
→ Git (branch-only)  
→ WGX  
→ Chronik  
→ Leitstand / Heimgeist / Heimlern  
→ Rückkopplung an leitwerk

**Sidecar-Prinzip**
- Crash-Isolation
- Rechte-Separation
- Engine-Austausch ohne UI-Umbau

---

## Kernaufgaben von leitwerk

### Agentensteuerung

leitwerk verwaltet Agenten über **schmale Adapter**, kein Framework:

agents/
jules.py
copilot.py
…


Minimaler Vertrag:

- Session starten
- Status abfragen
- Ergebnis abholen

Alles andere ist Agenten-Implementationsdetail.

---

### Kontextbereitstellung

leitwerk liefert Agenten **explizit begrenzten Kontext**:

- repoLens-Auszüge
- relevante Pfade
- relevante Contracts
- klare Aufgabenstellung

Nie:
- vollständige Repos
- implizite Freiheiten
- verdeckte Schreibrechte

Kontext ist reproduzierbar, versioniert und gehasht.

---

### Ergebnisnormalisierung

Agenten-Ergebnisse werden **nicht direkt verwendet**.

leitwerk übersetzt sie in kanonische Artefakte:

- `plan.v1`
- `patch.v1`
- `rationale.v1`
- `uncertainty.report.v1`

Erst danach sind sie diskutier- und ausführbar.

---

### Ausführung

- Patch-Anwendung ausschließlich über leitwerk
- Vorabprüfung (`git apply --check`)
- eigener Branch
- Commit nur nach expliziter Freigabe
- WGX guard ist Pflicht

Kein Agent schreibt direkt ins Repo.

---

### Multi-Repo-Koordination

leitwerk:

- erkennt Contract-Owner-Repos
- zerlegt Vorhaben in Teilaufgaben
- erzwingt Reihenfolgen
- koordiniert PR-Ketten
- verhindert parallelen Drift

Agenten dürfen diese Logik **nicht** übernehmen.

---

## Artefakte (kanonisch)

- `context.bundle.v1`
- `agent.result.raw.v1`
- `plan.v1`
- `patch.v1`
- `rationale.v1`
- `uncertainty.report.v1`
- `execution.log.v1`
- `guard.report.v1`
- `pr.manifest.v1`

Schemas liegen im **metarepo**.  
Owner aller Artefakte: **leitwerk**.

---

## Chronik-Events (Minimalset)

- `leitwerk.task.created`
- `leitwerk.agent.invoked`
- `leitwerk.agent.result.received`
- `leitwerk.exec.approved`
- `leitwerk.guard.passed`
- `leitwerk.guard.failed`
- `leitwerk.pr.created`
- `leitwerk.task.completed`
- `leitwerk.task.aborted`

---

## ACS-Integration

ACS ist:
- UI
- Statusanzeige
- Eingriffspunkt
- Kill-Switch

ACS:
- entscheidet nichts
- führt nichts aus
- besitzt keine Agentenlogik

---

## Sicherheitsmembran

- Repo-Locking
- Path-Allowlists
- Diff-Schwellen
- Secrets-Redaction
- Abbruch jederzeit möglich

---

## Entwicklungsphasen

**Phase 1**
- Jules CLI
- Single-Repo
- Patch-first
- manuelles Apply

**Phase 2**
- Multi-Repo-Ketten
- Chronik-Events
- Leitstand-Visualisierung

**Phase 3**
- mehrere Agenten
- Policy-Verfeinerung
- Heimgeist-Rückkopplung

---

## Verdichtete Essenz

**leitwerk ist die Instanz,  
an der Vorschläge Wirklichkeit werden dürfen – oder nicht.**

Alles andere ist Beratung.

---

## ∴fore — Ungewissheit

**Unsicherheitsgrad:** 0.23

**Ursachen**
- Agenten sind Blackboxes
- externe Tools ändern sich
- nicht alle Contracts finalisiert

**Bewertung**
- produktive Ungewissheit  
- Architektur bleibt stabil trotz Agentenwechsel

---

*Ironische Randnotiz:*  
Ein Agent ohne leitwerk ist wie ein GPS, das jede Abkürzung kennt,  
aber nicht weiß, ob die Brücke noch steht.
