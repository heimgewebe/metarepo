# **Blaupause: leitwerk**

## Agentengesteuerte Multirepo-Koordination f√ºr Heimgewebe

*(ACS Control-Surface ¬∑ Copilot SDK heute ¬∑ eigene Engine morgen)*

---

## Dialektische Er√∂rterung

### These

Ein autopoetisches Heimgewebe entsteht **nicht** durch maximale Agenten-Autonomie, sondern durch **harte, geschlossene Regelkreise**:

> **Command ‚Üí Planung ‚Üí Ausf√ºhrung ‚Üí Guard/Contracts ‚Üí Artefakt ‚Üí Beobachtung ‚Üí n√§chste Entscheidung**

**ACS** ist die Control-Surface.
**leitwerk** ist das koordinierende Organ.
**Copilot SDK** ist (vorl√§ufig) nur der Muskel.
**WGX, Contracts, Chronik, Leitstand** bilden die **Membran**, ohne die Geschwindigkeit in Drift umschl√§gt.

Autopoiesis hei√üt hier:
üëâ *Der Organismus ver√§ndert sich, ohne seine Invarianten zu verlieren.*

---

### Antithese

Direkte Agenten-Writes √ºber 20+ Repos erzeugen kurzfristig Eindruck von Macht ‚Äì langfristig jedoch:

* semantische Inkonsistenz
* stillen Contract-Bruch
* PR-Fluten ohne Kontext
* epistemische Blindheit (‚Äûes lief doch durch‚Äú)

Das ist keine Selbstorganisation, sondern **Git-getriebenes Rauschen**.
Ein schneller Agent ohne Membran ist kein Evolutionsmotor, sondern ein Driftbeschleuniger.

---

### Synthese

Die stabile Form ist:

> **leitwerk-first, Engine-second**

leitwerk tr√§gt:

* Heimgewebe-Wissen (Fleet-SoT, Contract-Ownership, Event-Semantik),
* Durchsetzungslogik (WGX, Branch-Gates),
* Audit-Pflicht (Chronik-Artefakte),
* Lernkopplung (Heimgeist / Heimlern).

Die Engine (Copilot heute, eigene morgen) bleibt **austauschbar**.
So wird ‚ÄûPower‚Äú zu **pr√ºfbarer Wirksamkeit**.

---

## 1) Zielbild und Invarianten

### Zielbild

**leitwerk** ist ein in ACS eingebettetes (Sidecar-basiertes) Koordinationsorgan, das:

* menschliche Prompts **und** systemische Trigger verarbeitet,
* daraus **geplante**, nachvollziehbare Multi-Repo-√Ñnderungen erzeugt,
* jede √Ñnderung **branch-only** ausf√ºhrt,
* pro Repo strukturierte PRs erzeugt,
* **WGX-Guards erzwingt**,
* alle Schritte als **Artefakte + Events** in Chronik einspeist,
* und mittelfristig ohne Architekturbruch die Copilot-Engine ersetzen kann.

---

### Unverhandelbare Invarianten

* **metarepo ist Control-Plane** (Fleet-SoT, Policies, interne Contracts).
* **Contracts-first**: Artefakt ohne Schema = nicht existent.
* **Events ‚â† Commands**: leitwerk nimmt Commands an, emittiert Events.
* **Durchsetzung vor Vertrauen**: WGX entscheidet, nicht Agent-Selbstauskunft.
* **Branch-Only-Writes**: niemals `main/master`.
* **Observability = Audit**: Leitstand zeigt Belege, nicht nur Status.
* **Unsicherheit ist Artefakt**: sie wird explizit gespeichert, nicht gegl√§ttet.

---

## 2) Namens- und Begriffsbindung (Etymologie)

* **leitwerk**
  *leiten* + *Faden* ‚Üí F√ºhrung durch Verbindung
  ‚Üí Kein Autopilot, sondern bewusstes Zusammenf√ºhren.

* **Agent** (lat. *agere*)
  ‚Üí Ausf√ºhrender, nicht Wahrheitsinstanz.

* **Orchestrieren** (gr. *organon*)
  ‚Üí geordnete Vielheit, nicht Zentralherrschaft.

* **Autopoiesis**
  ‚Üí Selbsterhalt durch Membran, nicht Selbstoptimierung.

Diese Begriffe sind **nicht dekorativ**, sondern normativ.

---

## 3) Organismus-Karte (pr√§zisiert)

### Bestehende Organe (relevant f√ºr leitwerk)

* **agent-control-surface (ACS)**
  UI, sichere Git-Wizards, lokale Betriebsinvarianten.

* **metarepo**
  Fleet-SoT, Policies, interne Contracts, Template-Quelle.

* **wgx**
  Guard / Smoke / Metrics / Fleet-Motorik (Enforcement).

* **chronik**
  Event-Backbone, Timeline, Replay-Quelle.

* **leitstand**
  Beobachtung, Audit-UI, Systemresonanz.

* **semantAH**
  Semantische Verdichtung, Graph, Drift-Erkennung.

* **heimgeist**
  Reflexions- und Aktionsartefakte (`insights.*`, `actions.*`).

* **heimlern**
  Lern- und Policy-R√ºckkopplung.

* **sichter**
  Zweitinstanzliche Review-Logik (semantisch/konventionell).

* **tools**
  u. a. **repoLens** als Kontext-Kondensator.

---

### Neues Organ

## **leitwerk**

*(Sidecar empfohlen)*

**Rolle:**
Koordination, Planung, Durchsetzung, Audit ‚Äì **nicht** direkte UI, **nicht** rohe Agentik.

---

## 4) Architektur (Idealform)

### Prozess-Topologie

**Client (Pop!_OS / iPad)**
‚Üí SSH LocalForward
‚Üí **ACS (127.0.0.1:8099)**
‚Üí **leitwerk Sidecar (localhost, z. B. :8098)**
‚Üí Engine (Copilot SDK heute)
‚Üí Git / PR / WGX
‚Üí Chronik (Events)
‚Üí Leitstand / Heimgeist / Heimlern
‚Üí R√ºckkopplung an leitwerk

### Warum Sidecar?

* Crash-Isolation (Agentik darf UI nicht rei√üen)
* Rechte-Separation (st√§rkeres Sandboxing)
* Engine-Austausch ohne ACS-Umbau

---

## 5) Die drei geschlossenen Schleifen (Kern)

### Loop A ‚Äî **Kontext**

**Ziel:** reproduzierbarer, auditierbarer Kontext.

* repoLens erzeugt `context.bundle.v1`

  * betroffene Repos
  * relevante Pfade
  * Contracts
  * letzte Insights
* Bundle ist versioniert + gehasht.

---

### Loop B ‚Äî **Ausf√ºhrung**

**Ziel:** deterministisch gerahmte Handlung.

* Engine erh√§lt nur `context.bundle` + `task.request`
* Liefert:

  * Plan
  * Patch-Vorschl√§ge
  * Tool-Intents
  * Unsicherheitsbericht
* leitwerk f√ºhrt aus **oder verweigert**.

---

### Loop C ‚Äî **Feedback**

**Ziel:** Lernen, nicht nur Fertigstellen.

* WGX erzeugt Reports
* Chronik speichert Events
* Sichter kommentiert
* Heimgeist erzeugt Insights
* Heimlern passt Policies an

---

## 6) Task- und Artefaktmodell (konkret)

### Task-Zust√§nde

```
CREATED
‚Üí CONTEXTED
‚Üí PLANNED
‚Üí EXECUTING
‚Üí GUARDED
‚Üí PR_CREATED
‚Üí REVIEWED
‚Üí DONE | FAILED
```

Jeder √úbergang = Event + Artefakt.

---

### Kanonische Artefakte (Schemas im metarepo!)

* `context.bundle.v1`
* `plan.v1`
* `execution.log.v1`
* `guard.report.v1`
* `pr.manifest.v1`
* `reflection.insights.v1`
* `policy.delta.v1`
* `uncertainty.report.v1`

---

### Chronik-Events (Minimalset)

* `leitwerk.task.created`
* `leitwerk.context.built`
* `leitwerk.plan.ready`
* `leitwerk.exec.started`
* `leitwerk.guard.finished`
* `leitwerk.pr.created`
* `leitwerk.task.failed`
* `leitwerk.task.completed`

---

## 7) ACS-Integration (kein Autopilot)

### UI-Module

1. Fleet-Overview
2. Task-Console (Prompt + Targets + Policy-Level)
3. Plan-Preview (inkl. Unsicherheit)
4. Diff / PR-View
5. Observability-Timeline
6. Kill-Switch (kontrolliert)

### ACS-API (Vorschlag)

```
POST /api/leitwerk/tasks
GET  /api/leitwerk/tasks/{id}
POST /api/leitwerk/tasks/{id}/plan
POST /api/leitwerk/tasks/{id}/exec
POST /api/leitwerk/tasks/{id}/abort
GET  /api/leitwerk/fleet
GET  /api/leitwerk/artifacts/{ref}
```

---

## 8) Engine-Abstraktion (entscheidend)

### Engine-Interface

```python
Engine.run(
  task_request,
  context_bundle,
  tool_registry
) -> engine_result
```

`engine_result` enth√§lt:

* Plan
* Patches
* Tool-Calls
* Rationale
* Unsicherheit

---

### Copilot SDK (Phase 1‚Äì2)

* CLI server-mode
* Tools beschnitten:

  * kein Web
  * kein sudo
  * Git nur √ºber leitwerk
* Idealfall:

  > Agent liefert Patch, leitwerk wendet an.

---

### Eigene Engine (Phase 3)

* lokales LLM oder eigener Dienst
* semantAH + heimgeist als Wissensschicht
* Tool-Execution bleibt bei leitwerk

---

## 9) Multi-Repo-Logik (USP)

### Zerlegung

1. Contract-Owner-Repo zuerst
2. Produzenten
3. Konsumenten
4. Observability / Docs

### Regeln

* Pro Repo eigener Branch + PR
* PR-Chain-Manifest
* Merge-Reihenfolge vorgeschlagen
* WGX √ºberall gr√ºn ‚Üí erst dann ‚Äûchain ready‚Äú

---

## 10) Membran: Sicherheit & Fehlerpr√§vention

* Path-Allowlists
* Diff-Schwellen
* Secrets-Redaction
* Repo-Locking
* Kill-Switch jederzeit

---

## 11) Betrieb

### Services

* `agent-control-surface.service`
* **`leitwerk.service`**

Mit:

* `NoNewPrivileges=true`
* `ProtectSystem=strict`
* gezielten `ReadWritePaths`

---

## 12) Phasenplan

### Phase 1

Single-Repo, Patch-first

### Phase 2

Multi-Repo-Chains + Leitstand-Timeline

### Phase 3

Engine-Swap ohne Architekturbruch

---

## 13) Zwei Alternativpfade

### A ‚Äî maximal auditierbar

Agent schreibt nie direkt Dateien.

### B ‚Äî st√§rker autopoietisch

Heimgeist / Sichter erzeugen Actions, Agent dient nur noch als Umsetzer.

---

## 14) Verdichtete Essenz

**leitwerk ist das Organ, das Geschwindigkeit in Koh√§renz √ºbersetzt.
Der Agent bewegt ‚Äì leitwerk entscheidet.**

---

## 15) Ironische Auslassung

Ein Agent ohne leitwerk ist wie ein GPS, das jede Abk√ºrzung kennt, aber nicht wei√ü, ob die Br√ºcke noch steht.

---

## ‚à¥fore ‚Äî Ungewissheit

**Unsicherheitsgrad:** 0.29

**Ursachen:**

* konkrete Chronik-/Artefakt-Schemas nicht vollst√§ndig verifiziert
* ACS-UI-Details nur abstrakt adressiert
* Copilot-SDK-Tooling versionsabh√§ngig

**Meta:**
Produktive Ungewissheit ‚Äì Architektur stabil, Feinschliff contract-getrieben.
