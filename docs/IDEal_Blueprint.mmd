%% IDEal_Blueprint.mmd — reine Mermaid-Quelle
%% Quelle für PNG/SVG via scripts/render-diagram.sh oder CI-Workflow render-diagrams
%% Fokus: Kern-Repos + semantische Flüsse (Contracts @ contracts-v1)

flowchart LR
  %% -------- Subsysteme / Ebenen --------
  subgraph Dialogisch
    MS[Mitschreiber / UI]\nintent capture
  end

  subgraph Semantisch
    SA[semantAH]\nGraph • Embeddings • Insights
  end

  subgraph Operativ
    HK[hausKI]\nPlan • Orchestrierung • State
    HA[hausKI-audio]\nAudio Sessions • Telemetrie
  end

  subgraph Reflexiv
    SI[sichter]\nDiagnose • Review • Korrektur
  end

  subgraph Memorativ
    LS[chronik]\nIngest • Episoden • Audit
  end

  subgraph Motorik & Außen
    WGX[wgx]\nPlaybooks • Systempflege • Metrics
    AS[aussensensor]\nFeeds • Webhooks → feed.jsonl
  end

  POL[(heimlern\nPolicies/Bandits)]

  %% -------- Datenflüsse / Contracts --------
  MS -- "intent/declare\n(events/intent.schema.json)" --> SA
  SA -- "graph/query" --> HK

  AS -- "aussen.event\n(contracts/aussen.event.schema.json)" --> LS
  AS -- "aussen.event\n(contracts/aussen.event.schema.json)" --> HK

  SA -- "insights\n(contracts/insights.schema.json)" --> HK
  WGX -- "metrics.snapshot\n(contracts/metrics.snapshot.schema.json)" --> HK
  HA -- "audio.events\n(contracts/audio.events.schema.json)" --> HK
  HA -- "audio.events\n(contracts/audio.events.schema.json)" --> LS

  HK -- "jobs / exec" --> WGX
  HK -- "review/report\n(events/review.schema.json · skizze)" --> SI
  SI -- "report → episode" --> LS
  LS -- "provenance → upsert" --> SA

  HK <-->"decide/feedback\n(contracts/policy.decision.schema.json)" POL

  %% -------- Hinweise --------
  classDef contract fill:#eef,stroke:#88a,stroke-width:1px,color:#223;
  classDef compute fill:#f6f6f6,stroke:#999,color:#222;
  class MS,SA,HK,HA,SI,LS,WGX,AS,POL compute;

  %% Legende (kompakt)
  %% - Alle Contract-Schemas werden über Tag `contracts-v1` versioniert und in CI validiert
  %% - Render-Command: scripts/render-diagram.sh docs/IDEal_Blueprint.mmd --outdir docs/diagrams --format png
