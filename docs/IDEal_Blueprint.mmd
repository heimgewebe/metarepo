%% IDEal_Blueprint.mmd — reine Mermaid-Quelle
%% Quelle für PNG/SVG via scripts/render-diagram.sh oder CI-Workflow render-diagrams
%% Fokus: Kern-Repos + semantische Flüsse (Contracts @ contracts-v1)

flowchart LR
  %% -------- Subsysteme / Ebenen --------
  subgraph Dialogisch
    MS["Mitschreiber / UI
intent capture"]
  end

  subgraph Semantisch
    SA["semantAH
Graph • Embeddings • Insights"]
  end

  subgraph Operativ
    HK["hausKI
Plan • Orchestrierung • State"]
    HA["hausKI-audio
Audio Sessions • Telemetrie"]
  end

  subgraph Reflexiv
    SI["sichter
Diagnose • Review • Korrektur"]
  end

  subgraph Memorativ
    LS["chronik
Ingest • Episoden • Audit"]
  end

  subgraph Motorik & Außen
    WGX["wgx
Playbooks • Systempflege • Metrics"]
    AS["aussensensor
Feeds • Webhooks → feed.jsonl"]
  end

  POL[("heimlern
Policies/Bandits")]

  %% -------- Datenflüsse / Contracts --------
  MS -- "intent/declare<br/>(events/intent.schema.json)" --> SA
  SA -- "graph/query" --> HK

  AS -- "aussen.event<br/>(contracts/aussen.event.schema.json)" --> LS
  AS -- "aussen.event<br/>(contracts/aussen.event.schema.json)" --> HK

  SA -- "insights<br/>(contracts/insights.schema.json)" --> HK
  WGX -- "metrics.snapshot<br/>(contracts/metrics.snapshot.schema.json)" --> HK
  HA -- "audio.events<br/>(contracts/audio.events.schema.json)" --> HK
  HA -- "audio.events<br/>(contracts/audio.events.schema.json)" --> LS

  HK -- "jobs / exec" --> WGX
  HK -- "review/report<br/>(events/review.schema.json · skizze)" --> SI
  SI -- "report → episode" --> LS
  LS -- "provenance → upsert" --> SA

  HK <-->"decide/feedback<br/>(contracts/policy.decision.schema.json)" POL

  %% -------- Hinweise --------
  classDef contract fill:#eef,stroke:#88a,stroke-width:1px,color:#223;
  classDef compute fill:#f6f6f6,stroke:#999,color:#222;
  class MS,SA,HK,HA,SI,LS,WGX,AS,POL compute;

  %% Legende (kompakt)
  %% - Alle Contract-Schemas werden über Tag `contracts-v1` versioniert und in CI validiert
  %% - Render-Command: scripts/render-diagram.sh docs/IDEal_Blueprint.mmd --outdir docs/diagrams --format png
