---
class: meta

tasks:
  smoke: |
    echo "Running workflow validation..."
    python3 -c '
    import glob, yaml, sys, pathlib
    files = list(glob.glob(".github/workflows/*.yml"))
    if not files:
        print("No workflows found, skipping.")
        sys.exit(0)
    for f in files:
        try:
            data = yaml.safe_load(pathlib.Path(f).read_text(encoding="utf-8"))
            if not isinstance(data, dict):
                raise TypeError("workflow root must be a mapping")
            print(f"OK   {f}")
        except Exception as e:
            print(f"FAIL {f}: {e}")
            sys.exit(1)
    print("All workflows valid.")
    '

  guard: |
    echo "Running meta-guard checks..."

    if command -v shellcheck >/dev/null 2>&1; then
      echo "Running shellcheck on wgx/**/*.bash..."
      # bewusst fokussiert auf WGX-Bash-Module; bei Bedarf erweiterbar
      shellcheck -s bash wgx/**/*.bash || exit 1
    else
      echo "shellcheck not found; skipping shell lint."
    fi

    if command -v yamllint >/dev/null 2>&1; then
      echo "Running yamllint..."
      yamllint . || exit 1
    else
      echo "yamllint not found; skipping YAML lint."
    fi

    echo "Guard OK."

  metrics: |
    if [ -x scripts/wgx-metrics-snapshot.sh ]; then
      scripts/wgx-metrics-snapshot.sh --json
    else
      echo "No metrics script for metarepo, skipping."
    fi

  snapshot: |
    # no snapshot command defined
