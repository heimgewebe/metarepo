set shell := ["bash", "-eu", "-o", "pipefail", "-c"]

default: help
help:
	@echo "Targets: up validate smoke agent-run agent-trace fmt lint test ci"

up:
	@if [ -x scripts/wgx ]; then \
	  scripts/wgx up; \
	else \
	  echo "hint: scripts/wgx fehlt im Ziel-Repo - bitte WGX installieren oder das Repo mit metarepo spiegeln." >&2; \
	  exit 1; \
	fi

validate:
	@if [ -x scripts/wgx ]; then \
	  scripts/wgx validate; \
	else \
	  echo "hint: scripts/wgx fehlt im Ziel-Repo - 'validate' nicht verfügbar." >&2; \
	  exit 1; \
	fi

smoke:
	@if [ -x scripts/wgx ]; then \
	  scripts/wgx smoke; \
	else \
	  echo "hint: scripts/wgx fehlt im Ziel-Repo - 'smoke' nicht verfügbar." >&2; \
	  exit 1; \
	fi

fmt:
	@echo "formatting…"; true

lint:
	@echo "linting…"; true

test:
	@echo "testing…"; true

ci: fmt lint test

# ---------- IDEal / Agents ----------
agent-run ARG?="agents/sample.workflow.json":
	@if [ -x scripts/wgx ]; then \
	  scripts/wgx agent run "{{ARG}}"; \
	else \
	  echo "hint: scripts/wgx fehlt – bitte Templates spiegeln (scripts/wgx up)"; \
	  exit 1; \
	fi

agent-trace FILE?="":
	@if [ -x scripts/wgx ]; then \
	  if [ -n "{{FILE}}" ]; then \
	    scripts/wgx agent trace "{{FILE}}"; \
	  else \
	    scripts/wgx agent trace; \
	  fi; \
	else \
	  echo "hint: scripts/wgx fehlt – bitte Templates spiegeln (scripts/wgx up)"; \
	  exit 1; \
	fi
