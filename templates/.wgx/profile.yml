class: meta

tasks:
  smoke: |
    python3 - <<'EOF'
import glob, yaml
for f in glob.glob('.github/workflows/*.yml'):
    try:
        yaml.safe_load(open(f))
        print(f"OK   {f}")
    except Exception as e:
        print(f"FAIL {f}: {e}")
        exit(1)
EOF

  guard: |
    if command -v shellcheck >/dev/null; then
      shellcheck -s bash wgx/**/*.bash
    fi
    yamllint .

  metrics: |
    if [ -x scripts/wgx-metrics-snapshot.sh ]; then
       scripts/wgx-metrics-snapshot.sh --json
    else
       echo "no metrics script; skipping"
    fi

  snapshot: ""
