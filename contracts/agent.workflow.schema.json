{
 "$schema": "https://json-schema.org/draft/2020-12/schema",
 "$id": "https://schemas.heimgewebe.org/agent.workflow.schema.json",
 "title": "Agent Workflow Manifest",
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "workflow_id": { "type": "string", "minLength": 1 },
 "name": { "type": "string" },
 "orchestration": { "type": "string", "enum": ["sequential", "parallel", "graph"], "default": "sequential" },
 "agents": {
 "type": "array",
 "minItems": 1,
 "items": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "id": { "type": "string", "minLength": 1 },
 "type": { "type": "string", "enum": ["code", "knowledge", "research", "supervisor", "ingest", "policy"] },
 "capabilities": { "type": "array", "items": { "type": "string" }, "default": [] },
 "inputs": { "type": "object", "additionalProperties": true, "default": {} },
 "outputs": { "type": "object", "additionalProperties": true, "default": {} },
 "command": {
 "oneOf": [
 { "type": "string" },
 { "type": "array", "items": { "type": "string" } }
 ]
 },
 "env": { "type": "object", "additionalProperties": { "type": "string" }, "default": {} }
 },
 "required": ["id", "type"]
 }
 },
 "graph": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "edges": {
 "type": "array",
 "items": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "from": { "type": "string" },
 "to": { "type": "string" },
 "when": { "type": "string", "description": "optional condition/expression" }
 },
 "required": ["from", "to"]
 },
 "default": []
 }
 },
 "default": { "edges": [] }
 },
 "policies": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "retry_strategy": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "max_retries": { "type": "integer", "minimum": 0, "default": 0 },
 "backoff": { "type": "string", "enum": ["none", "fixed", "exponential"], "default": "none" }
 },
 "default": { "max_retries": 0, "backoff": "none" }
 },
 "timeout_sec": { "type": "integer", "minimum": 1 },
 "cost_limits": {
 "type": "object",
 "additionalProperties": false,
 "properties": {
 "max_tokens": { "type": "integer", "minimum": 0 },
 "max_requests": { "type": "integer", "minimum": 0 }
 }
 }
 },
 "default": {}
 }
 },
 "required": ["workflow_id", "agents"]
}
