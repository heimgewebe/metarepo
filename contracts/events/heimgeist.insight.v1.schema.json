{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.heimgewebe.org/contracts/events/heimgeist.insight.v1.schema.json",
  "title": "Heimgeist Insight Event",
  "description": "Ein Insight-Event von Heimgeist (Meta-Analyse, Drift, Risiko).",
  "x-producers": ["heimgeist"],
  "x-consumers": ["chronik", "leitstand"],
  "type": "object",
  "required": ["kind", "version", "id", "meta", "data"],
  "properties": {
    "kind": {
      "type": "string",
      "const": "heimgeist.insight",
      "description": "Event-Art"
    },
    "version": {
      "type": "integer",
      "const": 1,
      "description": "Schema-Version"
    },
    "id": {
      "type": "string",
      "pattern": "^evt-",
      "description": "ID, Format: evt-${insight.id}"
    },
    "meta": {
      "type": "object",
      "required": ["occurred_at", "role"],
      "properties": {
        "occurred_at": {
          "type": "string",
          "format": "date-time",
          "description": "Zeitstempel (ISO8601)"
        },
        "role": {
          "type": "string",
          "enum": ["heimgeist", "archivist"],
          "description": "Rolle des Erzeugers"
        },
        "schema_version": {
          "type": "string",
          "description": "Optionale Versionierung"
        },
        "idempotency_key": {
          "type": "string",
          "description": "Schlüssel für Idempotenz"
        }
      },
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "description": "Nutzlast",
      "required": ["insight_type", "summary", "details"],
      "properties": {
        "insight_type": {
          "type": "string",
          "enum": ["risk", "drift", "pattern", "anomaly", "meta"],
          "description": "Kategorie"
        },
        "summary": {
          "type": "string"
        },
        "details": {
          "type": "string"
        },
        "context_refs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Referenzen (z.B. PR-URLs, URIs)"
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      }
    }
  },
  "additionalProperties": false
}
