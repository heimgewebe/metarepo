name: toolchain-guard
permissions:
  contents: read
on:
  push:
jobs:
  guard:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v5
      - name: Check prerequisites (just, yq)
        run: |
          set -euo pipefail
          if ! command -v just >/dev/null 2>&1; then
            echo '::error::just is not installed or not in PATH'
            exit 1
          fi
          if ! command -v yq >/dev/null 2>&1; then
            echo '::error::yq is not installed or not in PATH'
            exit 1
          fi
          if ! command -v ruby >/dev/null 2>&1; then
            echo '::notice::ruby not installed (optional)'
          fi
      - name: Lint GitHub workflows (actionlint)
        uses: rhysd/actionlint@v1.7.8
        with:
          args: -color
      - name: Show tool versions
        run: |
          set +e
          command -v uv >/dev/null 2>&1 && uv --version
          command -v just >/dev/null 2>&1 && just --version
          command -v yq >/dev/null 2>&1 && yq --version
          command -v gh >/dev/null 2>&1 && gh --version
          command -v ruby >/dev/null 2>&1 && ruby --version
          set -e
