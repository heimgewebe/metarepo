name: Publish Integrity Sources

on:
  push:
    branches:
      - main
    paths:
      - "reports/integrity/sources.v1.json"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  publish-sources:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure sources file exists
        run: |
          if [ ! -f "reports/integrity/sources.v1.json" ]; then
            echo "Error: reports/integrity/sources.v1.json not found!"
            exit 1
          fi

      - name: Publish sources.v1.json to Release
        uses: softprops/action-gh-release@c95fe1489396fe8a9eb87c0abf8aa5b2ef267fda # v2.2.1
        with:
          tag_name: integrity
          files: reports/integrity/sources.v1.json
          name: Integrity Artifacts
          body: "Canonical integrity sources and reports."
          make_latest: false
          # clobber is not explicitly supported by action-gh-release input,
          # but the action overwrites existing assets by default or handles updates.
